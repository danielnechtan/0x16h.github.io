<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="generator" content="romanzolotarev.com/bin/ssg3">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="/favicon.png">
<title>Cryogenix</title>
<style>body {
  margin: 0 auto;
  max-width: 700px;
  padding: 10px;
  background-color: #000000;
  color: #9ba4b2;
  background: url(data:image/gif;base64,R0lGODlhBgAGAJEAAP///xYWFgAAAAAAACwAAAAABgAGAAACCpQdhyqpfoKcoQAAOw==);
}

a {
  color: #204fd5;
 font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 18.5714px;
}

a:link {
    text-decoration: none;
}

a:visited {
    text-decoration: none;
  color: #334f83;
}
a:hover {
    text-decoration: underline;
  color: #204fd5;
}

body,
input,
button {
  font-size: 20px;
font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace;
}

hr,
h1,
h2 {
  margin-top: 60px;
}

hr {
  border: 0;
}

li {
  padding: 5px 0;
font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 18.5714px;
}

pre {
  font-size: 15px;
  overflow-x: auto;
}

pre,
blockquote {
  margin-bottom: 40px;
}

p img,
table {
  width: 100%;
}

p {
  clear: both;
}

.avatar {
  width: 60px;
  heigth: 60px;
  border-radius: 60px;
}

.left {
  float: left;
  margin: 8px 24px 24px 0;
}

.quote {
  text-indent: -16px;
  font-size: 32px;
  line-height: 40px;
}

.button,
.email {
  -webkit-appearance: none;
  color: #000000;
  padding: 15px;
}

.email {
  background-color: #ffffff;
  border: solid 1px #888888;
}

.button {
  background-color: #ffc469;
  border: solid 1px #ffc469;
  font-weight: bold;
  display: inline-block;
  text-align: center;
  text-decoration: none;
}

h1 { font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 24px; font-style: normal; font-variant: normal; font-weight: 700; line-height: 26.4px; } h3 { font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 700; line-height: 15.4px; } p { font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 20px; } blockquote { font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 21px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 30px; } pre { font-family: "Lucida Console", "Lucida Sans Typewriter", monaco, "Bitstream Vera Sans Mono", monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 18.5714px; }

pre {
  overflow-x: auto;
  color: white;
}

pre>code {
	background-color: #3c4047;
box-sizing: border-box;
display: block;
    white-space: pre;
  overflow-x: auto;
    padding-top: 0.5em;
    padding-right: 0.5em;
    padding-bottom: 0.5em;
    padding-left: 0.5em;
	    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
    border-bottom-right-radius: 3px;
    border-bottom-left-radius: 3px;
	padding-top: 2px;
    padding-right: 4px;
    padding-bottom: 2px;
    padding-left: 4px;
} 
ul {
 background-color: black;
}
p {
 background-color: black;
 padding: 5px;
}</style>
</head>
<body>
<body bgcolor="#000000" text="#FFFFFF">
<img width=300 src="cryo.jpg" alt="Cryogenix"/>
<p>Navigation: <a href="/">${HOME}</a> <a href="/rss.xml">/rss.xml</a> <a href="https://github.com/0x16h/">/github</a>  <a href="https://gab.ai/cryogenix">/Gab</a></p>
<h4 id="Down%20the%20Gopher%20hole%20with%20OpenBSD,%20Gophernicus,%20and%20TLS">Down the Gopher hole with OpenBSD, Gophernicus, and TLS</h4>

<p><strong>UPDATE: I&#39;ve added TLS support to Gophernicus so you don&#39;t need to use stunnel anymore. The code is ugly and unpolished though so I wouldn&#39;t recommend for production use.</strong> </p>

<ul>
<li><a href="https://github.com/0x16h/gophernicus">https://github.com/0x16h/gophernicus</a></li>
<li><a href="https://github.com/0x16h/gophernicus/blob/master/INSTALL.openbsd">INSTALL.openbsd</a></li>
</ul>

<p><img src="gopher-tls.png" alt="Gophernicus+TLS" /></p>

<p>In the early 2000s I thought I had seen the worst of the web - Java applets, Macromedia (&gt;Adobe) Flash, animated GIFs, javascript snow that kept you warm in the winter by burning out your CPU, and so on.  For a time we learned from these mistakes, and started putting the burden on the server-side - then with improvements in javascript engines we started abusing it again with JSON/AJAX and it all went down hill from there.</p>

<p>Like cloud computing, blockchains, machine learning and a tonne of other a la mode technologies around today - most users and service providers don&#39;t need websites that consume 1GB of memory processing JS and downloading 50MB of compressed data just to read Alice&#39;s one-page travel blog or Bob&#39;s notes on porting NetBSD to his blood-pressure monitor.</p>

<p>Before the HTTP web we relied on Prestel/Minitel style systems, BBS systems, and arguably the most accessible of all - Gopher! Gopher was similar to the locally accessed AmigaGuide format, in that it allowed users to search and retrieve documents interactively, with links and cross-references. Its efficiency and distraction-free nature make it attractive to those who are tired of the invasive, clickbait, ad-filled, javascript-laden web2/3.x. But enough complaining and evangelism - here&#39;s how to get your own Gopher Hole!</p>

<p>Gophernicus is a modern gopher daemon which aims to be secure (although it still uses inetd -_-); it&#39;s even in OpenBSD ports so at least we can rely on it to be reasonably audited. Let&#39;s install that and also an ncurses-based gopher client (or lynx(1)) to test things out later:</p>

<pre><code>$ doas pkg_add gophernicus gopher
</code></pre>

<p>If you plan on offering Gopher over TLS:</p>

<pre><code>$ doas pkg_add stunnel
</code></pre>

<p>Instruct inetd(8) how to handle gopher connections (defaults to port 70 TCP) by adding this to /etc/inetd.conf</p>

<pre><code>gopher stream tcp nowait _gophernicus /usr/local/libexec/in.gophernicus in.gophernicus -h go.cryogenix.net
</code></pre>

<ul>
<li>Replace go.cryogenix.net with your FQDN. </li>
<li>Add <strong>-T 343</strong> if you plan on using TLS on port 343 (IANA has no port allocated for Gopher over TLS but 343 is unassigned and I came across a post with someone mentioning it as a possibility).</li>
</ul>

<p>See <strong>/usr/local/share/doc/gophernicus/README</strong> for a full listing of command-line arguments and usage options; Gophernicus is feature-rich so it&#39;s recommended you RTFM carefully.</p>

<p>If you are using TLS, add a [gophernicus] service to /etc/stunnel/stunnel.conf. For the cert and key, I just added an alternative name for my domain in /etc/acme-client.conf, moved the old cert and ran <strong>acme-client -vFAD cryogenix.net</strong> to update my Let&#39;s Encrypt cert:</p>

<pre><code>[gophernicus]
cert = /etc/ssl/cryogenix.net.crt
key = /etc/ssl/private/cryogenix.net.key
accept = 343
connect = 127.0.0.1:70
protocol = proxy
</code></pre>

<p>Create a directory for our virtual host&#39;s gopher hole and copy the default &#39;index&#39; to it so we can test it:</p>

<pre><code>$ doas mkdir /var/gopher/go.cryogenix.net
$ doas cp /var/gopher/gophermap /var/gopher/go.cryogenix.net/
</code></pre>

<p>Enable and start inetd (and optionally stunnel):</p>

<pre><code>$ rcctl enable inetd
$ rcctl start inetd

$ rcctl enable stunnel
$ rcctl start stunnel
</code></pre>

<p>If you had no errors, you should now be able to use gopher(1) to connect to your server - either by hostname [and optional port] or gopher:// url.</p>

<pre><code>$ gopher gopher://go.cryogenix.net
</code></pre>

<p>If you used stunnel(1) to TLSify Gophernicus, one way you can connect with gopher(1) over TLS on port 343 is by using stunnel(1) on the client or socat(1):</p>

<pre><code>$ pkg_add stunnel
</code></pre>

<p>Add the following to /etc/stunnel/stunnel.conf:</p>

<pre><code>[gophers]
client = yes
accept = 127.0.0.1:10343
connect = &lt;hostname&gt;:343
CApath = /etc/ssl/cert.pem
</code></pre>

<p>Then start stunnel with rcctl and connect gopher to 127.0.0.1:10343.</p>

<p>Alternatively, with socat:</p>

<pre><code>$ doas pkg_add socat
$ socat TCP4-LISTEN:10070 openssl-connect:go.cryogenix.net:343,cafile=/etc/ssl/cert.pem,method=TLS1.2,verify=0,reuseaddr &amp;
$ gopher gopher://localhost:10070
</code></pre>

<h5 id="Caveats">Caveats</h5>

<ul>
<li>when connecting to stunnel, libressl returns error 21 (unable to verify first cert) - however the same cert returns no error on port 443 (httpd(8)).</li>
<li>socat(1) will die when the connection is closed or reaches EOF, which is on every gopher request. Normally we would add the &#39;fork&#39; option to the end of the openssl-connect command but for some reason it causes gopher(1) to become a runaway process and eat up CPU time.</li>
</ul>

<p>If you need a starting point with Gopher, SDF-EU&#39;s wiki has a good article <a href="https://sdfeu.org/w/tutorials:gopher">here</a>.</p>

<p>Finally, if you don&#39;t like gopher(1) - there&#39;s always lynx(1) or <a href="https://cryogenix.net/NCSA_Mosaic_OpenBSD.html">NCSA Mosaic</a>!</p>

<p><img src="gop2.jpg" alt="Gopher client viewing cryogenix" />
<img src="gop3.jpg" alt="Gopher client viewing cryogenix" />
<img src="gop.jpg" alt="Gopher on Mosaic Screenshot" /></p>
<p>Navigation: <a href="/">${HOME}</a></p>
<p>&copy; 2003-2018 Cryogenix | Powered by <a href="https://openbsd.org">OpenBSD</a> | Built with <a href="https://www.romanzolotarev.com/ssg.html">ssg3</a></p>
</body>
</html>
